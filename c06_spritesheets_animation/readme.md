# Godot â€“ Bases du jeux 2D <!-- omit in toc -->

# Table des matiÃ¨res <!-- omit in toc -->
- [Plan de leÃ§on](#plan-de-leÃ§on)
- [Notes](#notes)
- [Avant de dÃ©buter](#avant-de-dÃ©buter)
- [Les spritesheets et textures](#les-spritesheets-et-textures)
- [Les sprites animÃ©s](#les-sprites-animÃ©s)
- [Ajouter une feuille dans Godot](#ajouter-une-feuille-dans-godot)
- [AnimatedSprite](#animatedsprite)
  - [SpriteFrames](#spriteframes)
  - [Ajouter des images](#ajouter-des-images)
  - [Animer lâ€™image](#animer-limage)
  - [ContrÃ´ler lâ€™animation](#contrÃ´ler-lanimation)
- [Animer avec AnimationPlayer](#animer-avec-animationplayer)
  - [Configuration de la scÃ¨ne](#configuration-de-la-scÃ¨ne)
  - [Ajuster le nombre de cadres](#ajuster-le-nombre-de-cadres)
  - [Le volet `Animation`](#le-volet-animation)
  - [Ajouter une animation dans `AnimationPlayer`](#ajouter-une-animation-dans-animationplayer)
    - [Ajuster le temps de l'animation](#ajuster-le-temps-de-lanimation)
    - [Ajouter des cadres dans la timeline](#ajouter-des-cadres-dans-la-timeline)
    - [Ajuster les cadres de l'animation](#ajuster-les-cadres-de-lanimation)
    - [Visualiser l'animation](#visualiser-lanimation)
  - [ContrÃ´ler une animation avec `AnimationPlayer`](#contrÃ´ler-une-animation-avec-animationplayer)
- [DÃ©tail sur l'`AnimationPlayer`](#dÃ©tail-sur-lanimationplayer)
- [RÃ©sumÃ©](#rÃ©sumÃ©)

---

# Plan de leÃ§on
- Feuille de sprites (*spritesheet*)
- Ajouter une feuille dans Godot
- `AnimatedSprite`
- ContrÃ´le de base
- DÃ©placer un joueur

---

# Notes
- Plusieurs des images que j'aie prises dans ces diapositives proviennent du site itch.io
- Il y a plusieurs artistes qui offrent des ressources gratuites pour les jeux
- Plusieurs ensembles d'images sont Ã  vendre Ã  des prix trÃ¨s abordables (moins d'un repas Ã  la cafÃ©tÃ©ria! ğŸ˜…)

---

# Avant de dÃ©buter
- Avec le dÃ©pÃ´t Â«Â 0sw_projets_coursÂ Â»
- Faites un Â«Â git pullÂ Â» pour mettre Ã  jour le code
- CrÃ©ez une nouvelle branche Â«Â c06_spritesheetÂ Â»
- Assurez-vous que vous Ãªtes sur la bonne branche soit Â«Â git branchÂ Â»

---

# Les spritesheets et textures
- Charger une texture dans un jeu est trÃ¨s demandant pour le systÃ¨me
- Si le jeu devait charger 50 images pour la mÃªme animation, le jeu prendrait plus de mÃ©moire et de temps de chargement
- Pour optimiser le chargement des images, on utilise une feuille dâ€™images (*spritesheet*) que le systÃ¨me instancie

---

# Les sprites animÃ©s
- Les sprites animÃ©s reprÃ©sentent des dessins qui sâ€™animent dans un jeu 2D
- GÃ©nÃ©ralement, un sprite est une feuille avec plusieurs dessins de la mÃªme animation dont chacun est une pose diffÃ©rente

![alt text](assets/Run-Sheet.png)

- Pour animer, on affiche quâ€™une seule partie de la feuille Ã  lâ€™aide dâ€™une Â«Â fenÃªtreÂ Â» qui se promÃ¨ne dans celle-ci pour donner lâ€™impression dâ€™animation

![alt text](assets/Run.gif)

<!-- TODO : Faire une animation de fenÃªtre sur une feuille de sprite -->

---

# Ajouter une feuille dans Godot
- Glissez le fichier d'image dans le volet *FileSystem*
- Ensuite, vous aurez accÃ¨s Ã  ce fichier dans les ressources du projet

![alt text](assets/godot_import_image.gif)

---

# AnimatedSprite
- Dans cette partie, nous allons voir comment utiliser une faÃ§on simple pour animer un sprite dans Godot
- Utilisez un `AnimatedSprite` pour animer un sprite dans Godot
- Voici une structure typique pour un personnage 2D qui inclut un `AnimatedSprite`:
  - CharacterBody2D
    - AnimatedSprite2D
    - CollisionShape2D
- Lien vers la documentation officielle: [AnimatedSprite](https://docs.godotengine.org/en/stable/tutorials/2d/2d_sprite_animation.html)
- Projet de dÃ©monstration: a20c02a_animatedSprite

---

## SpriteFrames
- Une fois que lâ€™objet `AnimatedSprite` est dans la structure, il faudra lui assigner un `SpriteFrames` dans la propriÃ©tÃ© `Frames`
- Voici une mÃ©thode simple
  - SÃ©lectionner lâ€™AnimatedSprite, aller dans la propriÃ©tÃ© `Sprite Frames` et sÃ©lectionner `New SpriteFrames`
  - Dans le volet infÃ©rieur, on verra `SpriteFrames` apparaÃ®tre
    - Si le volet nâ€™apparaÃ®t pas, cliquer sur SpriteFrames
  - Ce volet sert Ã  dÃ©finir les animations

![alt text](assets/godot_animatedSprite.webp)

---

## Ajouter des images
- Dans la partie gauche du volet `SpriteFrames`, on y retrouve la liste des animations
  - Par dÃ©faut, on voit *default*
- Plusieurs faÃ§ons existent pour ajouter des images dans lâ€™animation
- Si on a plusieurs fichiers dâ€™images pour lâ€™animation dans le systÃ¨me de fichier, il suffit de les sÃ©lectionner et de les glisser dans la zone **Trames dâ€™animation** (*Animation Frames*)

---

- Lâ€™utilisation dâ€™un *sprite sheet* est favorable, car cela demande moins de ressource
- On peut utiliser le bouton `Add frame from sprite sheet` qui permet de sÃ©lectionner
- Câ€™est le bouton qui ressemble Ã  une grille
- Il suffira de sÃ©lectionner le fichier de la feuille dâ€™images et ensuite de sÃ©lectionner les images dÃ©sirÃ©es pour lâ€™animation courante

![Ajouter le sprite sheet](assets/godot_spriteframes.gif)

![Selectionner les trames](assets/godot_selectionner_les_trames.gif)

---

## Animer lâ€™image
- Vous pouvez prÃ©visualiser lâ€™animation en cliquant sur le bouton Play dans SpriteFrames

![alt text](assets/godot_preview_animation.gif)

---

## ContrÃ´ler lâ€™animation
Une fois que l'animation est prÃªte, il est possible de contrÃ´ler l'animation Ã  l'aide d'un script. Ajouter un script au noeud parent de l'AnimatedSprite2d et coller ce script simple en GDScript:

```gd
extends CharacterBody2D

@onready var _animated_sprite = $AnimatedSprite2D

func _process(_delta):
	if Input.is_action_pressed("ui_right"):
		_animated_sprite.play("run")
	else:
		_animated_sprite.stop()
```

> **Note**: Si on a suivi les Ã©tapes prÃ©cÃ©dentes, il devrait y avoir un bogue. Pourquoi?

<!-- L'animation se nomme "default" au lieu de "run" -->

---

# Animer avec AnimationPlayer
- L'`AnimatedSprite` est une faÃ§on simple d'animer un sprite lorsqu'il y a peu d'animations
- Pour des animations plus complexes, il est prÃ©fÃ©rable d'utiliser l'`AnimationPlayer`
- Il faudra un nÅ“ud `Sprite2D` pour afficher la texture, puis d'animer les changements de texture avec `AnimationPlayer`.

---

## Configuration de la scÃ¨ne

- TÃ©lÃ©chargez la feuille de sprite ci-dessous et configurez votre scÃ¨ne.

![alt text](assets/2d_animation_player-run.webp)

- Configurez l'arbre de scÃ¨ne avec les nÅ“uds requis.

![alt text](assets/2d_animation_tree2.webp)

---

## Ajuster le nombre de cadres

- En ayant le nÅ“ud `Sprite2D` sÃ©lectionnÃ©, configurez les cadres en modifiant `Hframes` Ã  6.
  - C'est dans la section `Animation` de la propriÃ©tÃ© `Sprite2D`.

![alt text](assets/godot_set_hframes.gif)

- Remarquez qu'il y a aussi la propriÃ©tÃ© `Vframes` qui reprÃ©sente le nombre de cadres verticaux.
- Les propriÃ©tÃ©s `Hframes` et `Vframes` sont utilisÃ©es pour diviser la feuille de sprite en cadres.

---

## Le volet `Animation`

- Vous devriez apercevoir un volet `Animation` dans le bas de la fenÃªtre de Godot. Cliquez sur le bouton `Animation` pour ouvrir le volet.
- C'est dans ce volet que vous pouvez ajouter des animations et des cadres.

---

## Ajouter une animation dans `AnimationPlayer`
- Cliquez sur le bouton `Animation` pour afficher le menu dÃ©roulant.
- SÃ©lectionner `Nouveau...` pour ajouter une nouvelle animation.
- Dans la fenÃªtre qui apparaÃ®t, nommez l'animation "walk" et confirmez.

![alt text](assets/Godot_v4.3-stable_mono_win64_0n5PbanZ6u.gif)

---

### Ajuster le temps de l'animation
- Dans le volet `Animation`, sÃ©lectionnez l'animation "walk".
- Au bout de la ligne de temps, cliquez oÃ¹ il est Ã©crit 1.
- Inscrivez 0.6 pour ajuster la longueur de l'animation Ã  0.6 secondes.
- Ajustez la visualisation de la ligne de temps en maintenant la touche `Ctrl` enfoncÃ©e et en faisant dÃ©filer la souris sur la ligne de temps.

![alt text](assets/godot_timeline_zoom.gif)

### Ajouter des cadres dans la timeline
- Dans la ligne du temps, cliquez sur le 0 pour ajuster le point de dÃ©part de l'animation.
  - Il s'agit de la petite ligne bleue sur la ligne du temps.
- SÃ©lectionnez le noeud `Sprite2D` dans l'arbre de scÃ¨ne.
- Dans l'inspecteur, sÃ©lectionnez l'onglet `Animation`.
- Dans la propriÃ©tÃ© `Frames`, cliquez sur le bouton `+`
- Une fenÃªtre apparaÃ®tra pour ajouter des cadres Ã  l'animation.
- Cliquez sur `CrÃ©er` pour ajouter un cadre. 

![alt text](assets/godot_timeline_add_frame.gif)

- Cette action ajouter une image Ã  l'animation tout en ajoutant une piste dans le volet `Animation`.
- Cliquez encore sur le bouton `+` pour ajouter un autre cadre.
- RÃ©pÃ©tez cette Ã©tape pour ajouter les 6 cadres de l'animation.

![alt text](assets/godot_timeline_add_frames.gif)

### Ajuster les cadres de l'animation
- Pour ajuster les cadres de l'animation, sÃ©lectionnez un cadre dans le volet `Animation`.
- Glissez le cadre pour ajuster l'ordre des cadres ainsi que l'emplacement dans la ligne du temps.

![alt text](assets/godot_timeline_adjust_img.gif)

### Visualiser l'animation
- Pour visualiser l'animation, cliquez sur le bouton `Play` dans le volet `Animation`.
- On remarque que l'animation ne joue pas en boucle.
- Pour ajuster cela, sÃ©lectionnez l'animation dans le volet `Animation` et cochez le bouton `Loop`.
- Il se situe Ã  la fin de la ligne du temps.

![alt text](assets/godot_timeline_play_loop.gif)

---

## ContrÃ´ler une animation avec `AnimationPlayer`

Tout comme avec `AnimatedSprite2D`, vous pouvez contrÃ´ler l'animation via code avec les mÃ©thodes `play()` et `stop()`. Voici un exemple similaire pour jouer l'animation pendant que la touche droite est enfoncÃ©e.

```gd
extends CharacterBody2D

@onready var _animation_player = $AnimationPlayer

func _process(_delta):
	if Input.is_action_pressed("ui_right"):
		_animation_player.play("walk")
	else:
		_animation_player.stop()

```

---

# DÃ©tail sur l'`AnimationPlayer`
- L'`AnimationPlayer` est un nÅ“ud qui permet, **entre autres**, de contrÃ´ler les animations dans Godot
- En fait l'`AnimationPlayer` est un contrÃ´leur de valeurs
- Lorsque l'on a ajoutÃ© une animation, l'`AnimationPlayer` a contrÃ´lÃ© la propriÃ©tÃ© `frame` du `Sprite2D` pour changer l'image affichÃ©e
- L'`AnimationPlayer` peut contrÃ´ler n'importe quelle propriÃ©tÃ© d'un nÅ“ud dans Godot
- On pourrait faire varier la transparence, la position, la rotation, etc.

---

# RÃ©sumÃ©
- Les sprites animÃ©s sont des images qui changent pour donner l'impression de mouvement
- Les sprites animÃ©s sont gÃ©nÃ©ralement des feuilles de sprites
- Les feuilles de sprites sont des images qui contiennent plusieurs images
- Pour animer un sprite dans Godot, on utilise un `AnimatedSprite` ou un `AnimationPlayer`
- `AnimatedSprite` est utilisÃ© pour des animations simples
- `AnimationPlayer` est utilisÃ© pour des animations plus complexes